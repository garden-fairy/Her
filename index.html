<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Her â€” Cycle & Pregnancy Companion</title>
  <link rel="stylesheet" href="style.css" />
<meta name="theme-color" content="#0c0f13">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
<link rel="apple-touch-icon" href="icons/apple-touch-icon.png">
</head>
<body>
  <header class="appbar">
    <div class="brand">
      <span class="logo">ğŸ’—</span>
      <h1>Her</h1>
    </div>
    <button id="openTips" class="icon-btn" aria-label="Tips">ğŸ“š</button>
  </header>

  <main class="container">

    <!-- Period log card -->
    <section class="card">
      <div class="card-head">
        <h2>ğŸ”¥ Log period</h2>
        <p class="muted">Log when your period starts or ends. Add heaviness & symptoms.</p>
      </div>

      <div class="stack-gap">
        <button class="btn primary" id="openAdd">Add Entry</button>

        <ul id="entries" class="list"></ul>

        <p id="emptyState" class="muted center" hidden>No entries yet. Tap â€œAdd Entryâ€.</p>
      </div>
    </section>

    <!-- Learn / tips -->
    <section class="card">
      <div class="card-head">
        <h2>ğŸ“– Learn</h2>
        <p class="muted">Quick, medically-reviewed cycle info.</p>
      </div>
      <a class="btn ghost" href="https://www.nhs.uk/conditions/periods/" target="_blank" rel="noopener">Read NHS tips</a>
    </section>
  </main>

  <!-- Floating action button -->
  <button id="fabAdd" class="fab" aria-label="Add entry">ï¼‹</button>

  <!-- Add/Edit modal -->
  <dialog id="entryModal" class="modal">
    <form id="entryForm" method="dialog" class="sheet">
      <header class="sheet-head">
        <h3 id="sheetTitle">Add entry</h3>
        <button type="button" class="icon-btn" id="closeModal" aria-label="Close">âœ–ï¸</button>
      </header>

      <div class="field">
        <label>Date & time</label>
        <input type="datetime-local" id="dt" required />
      </div>

      <div class="field">
        <label>Type</label>
        <div class="segmented" role="group">
          <input type="radio" id="start" name="ptype" value="start" checked>
          <label for="start">Start</label>
          <input type="radio" id="end" name="ptype" value="end">
          <label for="end">End</label>
        </div>
      </div>

      <div class="field">
        <label>Flow heaviness</label>
        <div class="chips" id="heavyChips">
          <input type="radio" id="light" name="heavy" value="light" checked>
          <label for="light">ğŸŸ¡ Light</label>
          <input type="radio" id="medium" name="heavy" value="medium">
          <label for="medium">ğŸŸ  Medium</label>
          <input type="radio" id="heavy" name="heavy" value="heavy">
          <label for="heavy">ğŸ”´ Heavy</label>
        </div>
      </div>

      <div class="field">
        <label>Symptoms</label>
        <div class="chips multi">
          <!-- Feel free to tweak these -->
          <input type="checkbox" id="cramps" value="Cramps">
          <label for="cramps">ğŸ’¢ Cramps</label>

          <input type="checkbox" id="bloating" value="Bloating">
          <label for="bloating">ğŸŒ«ï¸ Bloating</label>

          <input type="checkbox" id="fatigue" value="Fatigue">
          <label for="fatigue">ğŸ˜´ Fatigue</label>

          <input type="checkbox" id="headache" value="Headache">
          <label for="headache">ğŸ¤• Headache</label>

          <input type="checkbox" id="mood" value="Mood swings">
          <label for="mood">ğŸ˜µâ€ğŸ’« Mood</label>

          <input type="checkbox" id="nausea" value="Nausea">
          <label for="nausea">ğŸ¤¢ Nausea</label>

          <input type="checkbox" id="back" value="Back pain">
          <label for="back">ğŸ’¢ Back</label>

          <input type="checkbox" id="acne" value="Acne">
          <label for="acne">ğŸ§´ Acne</label>
        </div>
      </div>

      <div class="sheet-actions">
        <button type="button" class="btn ghost" id="cancelBtn">Cancel</button>
        <button class="btn primary" id="saveBtn">Save</button>
      </div>
    </form>
  </dialog>

  <footer class="foot muted">Â© <span id="yr"></span> Her â€” All rights reserved.</footer>

  <script>
  // --------- storage helpers ----------
  const KEY = 'her.periodEntries.v1';
  const $ = sel => document.querySelector(sel);

  const load = () => {
    try { return JSON.parse(localStorage.getItem(KEY)) || []; }
    catch { return []; }
  }
  const save = (arr) => localStorage.setItem(KEY, JSON.stringify(arr));

  // --------- state & DOM refs ----------
  let entries = load();

  const ul = $('#entries');
  const empty = $('#emptyState');
  const modal = $('#entryModal');
  const form = $('#entryForm');
  const dt = $('#dt');
  const sheetTitle = $('#sheetTitle');

  // default date
  const nowISO = () => new Date(Date.now() - new Date().getTimezoneOffset()*60000).toISOString().slice(0,16);

  function render() {
    ul.innerHTML = '';
    if (!entries.length) {
      empty.hidden = false;
      return;
    }
    empty.hidden = true;

    entries
      .sort((a,b)=> new Date(b.dt) - new Date(a.dt))
      .forEach((e, i) => {
        const li = document.createElement('li');
        li.className = 'row';
        const when = new Date(e.dt);
        const dateStr = when.toLocaleString();

        const heavemap = { light:'ğŸŸ¡ Light', medium:'ğŸŸ  Medium', heavy:'ğŸ”´ Heavy' };
        const badge = heavemap[e.heavy] || e.heavy;

        li.innerHTML = `
          <div class="row-main">
            <div class="title">
              ${e.type === 'start' ? 'ğŸ©¸ Period started' : 'âœ… Period ended'}
            </div>
            <div class="meta">
              ${dateStr} â€¢ <span class="badge">${badge}</span>
              ${e.symptoms?.length ? ' â€¢ ' + e.symptoms.map(s => `<span class="pill">${s}</span>`).join(' ') : ''}
            </div>
          </div>
          <div class="row-actions">
            <button class="icon-btn" title="Delete" aria-label="Delete" data-del="${i}">ğŸ—‘ï¸</button>
          </div>
        `;
        ul.appendChild(li);
      });
  }

  // --------- modal open/close ----------
  function openAdd() {
    form.reset();
    dt.value = nowISO();
    sheetTitle.textContent = 'Add entry';
    modal.showModal();
  }
  function closeModal() {
    modal.close();
  }

  // --------- save entry ----------
  form.addEventListener('submit', (ev) => {
    ev.preventDefault();

    const type = form.querySelector('input[name="ptype"]:checked').value;
    const heavy = form.querySelector('input[name="heavy"]:checked').value;

    const symptoms = Array.from(form.querySelectorAll('.chips.multi input[type="checkbox"]'))
      .filter(c => c.checked)
      .map(c => c.value);

    const entry = {
      dt: dt.value,
      type,
      heavy,
      symptoms
    };

    entries.push(entry);
    save(entries);
    render();
    closeModal();
  });

  // delete
  ul.addEventListener('click', (e) => {
    const del = e.target.closest('[data-del]');
    if (!del) return;
    const idx = +del.dataset.del;
    entries.splice(idx, 1);
    save(entries);
    render();
  });

  // buttons & misc
  $('#openAdd').addEventListener('click', openAdd);
  $('#fabAdd').addEventListener('click', openAdd);
  $('#closeModal').addEventListener('click', closeModal);
  $('#cancelBtn').addEventListener('click', closeModal);
  $('#openTips').addEventListener('click', () => {
    window.open('https://www.nhs.uk/conditions/periods/', '_blank');
  });

  // init
  $('#yr').textContent = new Date().getFullYear();
  render();
  </script>
</body>
</html>
